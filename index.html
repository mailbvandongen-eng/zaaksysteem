<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaaksysteem Keten - Gemeente Westland</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .submenu {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--gray-light);
            border-radius: 8px;
        }
        .submenu.visible {
            display: block;
        }
        .submenu-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text);
        }
        .submenu-options {
            display: flex;
            gap: 0.75rem;
        }
        .submenu-option {
            padding: 0.75rem 1.5rem;
            background: var(--white);
            border: 2px solid var(--gray);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .submenu-option:hover {
            border-color: var(--primary-light);
        }
        .submenu-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .flow-path {
            fill: none;
            stroke: var(--primary-light);
            stroke-width: 4;
            stroke-dasharray: 12 6;
            stroke-linecap: round;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .flow-path.visible {
            opacity: 1;
            animation: flowDash 1s linear infinite;
        }
        @keyframes flowDash {
            to { stroke-dashoffset: -18; }
        }
        .node.dimmed {
            opacity: 0.25;
        }
        .node.highlighted {
            opacity: 1;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="https://www.gemeentewestland.nl/fileadmin/Gemeente_Westland/site_assets/logowestland.svg" alt="Gemeente Westland">
        </div>
        <h1>Zaaksysteem Ketenvisualisatie</h1>
    </header>

    <nav>
        <ul>
            <li><a href="index.html" class="active">Overzicht</a></li>
            <li><a href="perspectief/behandelaar.html">Behandelaar</a></li>
            <li><a href="perspectief/aanvrager.html">Aanvrager</a></li>
            <li><a href="perspectief/kcc.html">KCC</a></li>
            <li><a href="implementatie/7-vinkjes.html">7 Vinkjes</a></li>
            <li><a href="componenten/systemen.html">Systemen</a></li>
        </ul>
    </nav>

    <main>
        <!-- Perspective switcher -->
        <section>
            <h3>Bekijk de keten vanuit jouw perspectief</h3>
            <div class="perspective-cards">
                <div class="perspective-card" data-perspective="aanvrager">
                    <h5>Aanvrager</h5>
                    <p>Burger of bedrijf</p>
                </div>
                <div class="perspective-card" data-perspective="behandelaar">
                    <h5>Behandelaar</h5>
                    <p>Werkt in de keten</p>
                </div>
                <div class="perspective-card" data-perspective="kcc">
                    <h5>KCC</h5>
                    <p>Klantcontact</p>
                </div>
                <div class="perspective-card" data-perspective="registratie">
                    <h5>Team Registratie</h5>
                    <p>Post en scan</p>
                </div>
            </div>

            <!-- Submenu voor aanvrager -->
            <div id="submenu-aanvrager" class="submenu">
                <div class="submenu-title">Kies een domein:</div>
                <div class="submenu-options">
                    <div class="submenu-option" data-flow="sd">Sociaal Domein (WMO, GPK)</div>
                    <div class="submenu-option" data-flow="bz">Burgerzaken (Paspoort, Rijbewijs)</div>
                </div>
            </div>
        </section>

        <!-- Main flow diagram -->
        <section class="flow-container">
            <h3>De Zaaksysteem Keten</h3>
            <div class="toggle-container">
                <span>Toon technische laag</span>
                <div class="toggle" data-target="tech-layer"></div>
            </div>

            <div class="flow-diagram">
                <svg viewBox="0 0 1200 600" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrowhead-flow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#74B943"/>
                        </marker>
                    </defs>

                    <!-- Background layers -->
                    <rect x="40" y="40" width="200" height="520" fill="#E8F5E9" rx="8" opacity="0.5"/>
                    <text x="140" y="70" text-anchor="middle" font-size="14" fill="#44772C" font-weight="600">KANALEN</text>

                    <rect x="260" y="40" width="180" height="520" fill="#E3F2FD" rx="8" opacity="0.5"/>
                    <text x="350" y="70" text-anchor="middle" font-size="14" fill="#1976D2" font-weight="600">INTAKE</text>

                    <rect x="460" y="40" width="280" height="520" fill="#FFF3E0" rx="8" opacity="0.5"/>
                    <text x="600" y="70" text-anchor="middle" font-size="14" fill="#E65100" font-weight="600">VERWERKING</text>

                    <rect x="760" y="40" width="200" height="520" fill="#F3E5F5" rx="8" opacity="0.5"/>
                    <text x="860" y="70" text-anchor="middle" font-size="14" fill="#7B1FA2" font-weight="600">TERUGKOPPELING</text>

                    <rect x="980" y="40" width="180" height="520" fill="#E0F7FA" rx="8" opacity="0.5"/>
                    <text x="1070" y="70" text-anchor="middle" font-size="14" fill="#00838F" font-weight="600">INZICHT</text>

                    <!-- KANALEN -->
                    <g class="node node-kanaal" data-system="gemeentewestland">
                        <rect x="60" y="100" width="160" height="50" fill="#4CAF50" rx="6"/>
                        <text x="140" y="130" text-anchor="middle" fill="white" font-size="13" font-weight="500">gemeentewestland.nl</text>
                    </g>

                    <g class="node node-kanaal" data-system="balie">
                        <rect x="60" y="170" width="160" height="50" fill="#66BB6A" rx="6"/>
                        <text x="140" y="200" text-anchor="middle" fill="white" font-size="13" font-weight="500">Balie</text>
                    </g>

                    <g class="node node-kanaal" data-system="telefoon">
                        <rect x="60" y="240" width="160" height="50" fill="#81C784" rx="6"/>
                        <text x="140" y="270" text-anchor="middle" fill="white" font-size="13" font-weight="500">Telefoon</text>
                    </g>

                    <g class="node node-kanaal" data-system="post">
                        <rect x="60" y="310" width="160" height="50" fill="#A5D6A7" rx="6"/>
                        <text x="140" y="340" text-anchor="middle" fill="#1A1919" font-size="13" font-weight="500">Post / Scan</text>
                    </g>

                    <!-- INTAKE -->
                    <g class="node node-formulier" data-system="simform">
                        <rect x="280" y="100" width="140" height="50" fill="#2196F3" rx="6"/>
                        <text x="350" y="130" text-anchor="middle" fill="white" font-size="13" font-weight="500">SIMform</text>
                    </g>

                    <g class="node node-formulier" data-system="ediensten">
                        <rect x="280" y="170" width="140" height="50" fill="#42A5F5" rx="6"/>
                        <text x="350" y="200" text-anchor="middle" fill="white" font-size="13" font-weight="500">Centric eDiensten</text>
                    </g>

                    <g class="node" data-system="digid">
                        <rect x="280" y="400" width="140" height="40" fill="#FF5722" rx="6"/>
                        <text x="350" y="425" text-anchor="middle" fill="white" font-size="12" font-weight="500">DigiD</text>
                    </g>

                    <g class="node" data-system="eherkenning">
                        <rect x="280" y="450" width="140" height="40" fill="#FF7043" rx="6"/>
                        <text x="350" y="475" text-anchor="middle" fill="white" font-size="12" font-weight="500">eHerkenning</text>
                        <text x="350" y="490" text-anchor="middle" fill="white" font-size="9">(komt erbij)</text>
                    </g>

                    <!-- Scanner detail -->
                    <g class="node" data-system="scanner">
                        <rect x="280" y="310" width="140" height="50" fill="#78909C" rx="6"/>
                        <text x="350" y="335" text-anchor="middle" fill="white" font-size="12" font-weight="500">Dyanix Scansuite</text>
                        <text x="350" y="350" text-anchor="middle" fill="white" font-size="10">Team Registratie</text>
                    </g>

                    <!-- VERWERKING -->
                    <g class="node node-zaaksysteem" data-system="rx-enterprise">
                        <rect x="500" y="180" width="200" height="70" fill="#44772C" rx="8"/>
                        <text x="600" y="210" text-anchor="middle" fill="white" font-size="15" font-weight="600">Rx.Enterprise</text>
                        <text x="600" y="230" text-anchor="middle" fill="white" font-size="11">Zaaksysteem + Documenten</text>
                    </g>

                    <!-- Afhandelsystemen -->
                    <g class="node node-afhandel" data-system="centric-bz">
                        <rect x="480" y="300" width="110" height="50" fill="#FF9800" rx="6"/>
                        <text x="535" y="325" text-anchor="middle" fill="white" font-size="11" font-weight="500">Centric</text>
                        <text x="535" y="340" text-anchor="middle" fill="white" font-size="11" font-weight="500">Burgerzaken</text>
                    </g>

                    <g class="node node-afhandel" data-system="s4sd">
                        <rect x="600" y="300" width="110" height="50" fill="#FFA726" rx="6"/>
                        <text x="655" y="325" text-anchor="middle" fill="white" font-size="11" font-weight="500">Suite4SD</text>
                        <text x="655" y="340" text-anchor="middle" fill="white" font-size="10">(GPK live!)</text>
                    </g>

                    <g class="node node-afhandel" data-system="stratech">
                        <rect x="480" y="360" width="110" height="45" fill="#FFB74D" rx="6"/>
                        <text x="535" y="385" text-anchor="middle" fill="#1A1919" font-size="11" font-weight="500">Stratech</text>
                        <text x="535" y="398" text-anchor="middle" fill="#1A1919" font-size="9">(naar cloud)</text>
                    </g>

                    <g class="node node-afhandel" data-system="toekomstig" style="opacity: 0.6">
                        <rect x="600" y="360" width="110" height="45" fill="#FFE0B2" rx="6" stroke="#FF9800" stroke-dasharray="4"/>
                        <text x="655" y="385" text-anchor="middle" fill="#1A1919" font-size="11">JVS, Begraven</text>
                        <text x="655" y="398" text-anchor="middle" fill="#666" font-size="9">(toekomstig)</text>
                    </g>

                    <!-- Middleware (tech layer) -->
                    <g id="tech-layer" class="node node-middleware" data-system="enable-u">
                        <rect x="500" y="430" width="200" height="45" fill="#607D8B" rx="6"/>
                        <text x="600" y="455" text-anchor="middle" fill="white" font-size="12" font-weight="500">Enable-U (API Gateway)</text>
                        <text x="600" y="468" text-anchor="middle" fill="white" font-size="9">Filter zaak- en documenttypen</text>
                    </g>

                    <g id="tech-layer-2" class="node node-middleware" data-system="cloudadapter" style="opacity: 0.7">
                        <rect x="500" y="490" width="200" height="35" fill="#78909C" rx="6"/>
                        <text x="600" y="512" text-anchor="middle" fill="white" font-size="11">Centric Cloud Adapter</text>
                    </g>

                    <!-- TERUGKOPPELING -->
                    <g class="node node-pip" data-system="pip">
                        <rect x="780" y="130" width="160" height="60" fill="#9C27B0" rx="6"/>
                        <text x="860" y="158" text-anchor="middle" fill="white" font-size="14" font-weight="500">PIP</text>
                        <text x="860" y="175" text-anchor="middle" fill="white" font-size="10">Status volgen</text>
                        <text x="860" y="187" text-anchor="middle" fill="white" font-size="10">Documenten up/download</text>
                    </g>

                    <g class="node" data-system="notificatie">
                        <rect x="780" y="210" width="160" height="45" fill="#BA68C8" rx="6"/>
                        <text x="860" y="237" text-anchor="middle" fill="white" font-size="12" font-weight="500">Notificaties (mail)</text>
                    </g>

                    <!-- INZICHT -->
                    <g class="node node-kcc" data-system="rx-front">
                        <rect x="1000" y="130" width="140" height="60" fill="#00BCD4" rx="6"/>
                        <text x="1070" y="158" text-anchor="middle" fill="white" font-size="14" font-weight="500">Rx.Front</text>
                        <text x="1070" y="175" text-anchor="middle" fill="white" font-size="10">KCC - Klantbeeld</text>
                    </g>

                    <g class="node" data-system="powerbi">
                        <rect x="1000" y="210" width="140" height="45" fill="#26C6DA" rx="6"/>
                        <text x="1070" y="237" text-anchor="middle" fill="white" font-size="12" font-weight="500">PowerBI / DWH</text>
                    </g>

                    <!-- Legacy -->
                    <g class="node" data-system="corsa" style="opacity: 0.5">
                        <rect x="1000" y="480" width="140" height="45" fill="#BDBDBD" rx="6" stroke="#F44336" stroke-dasharray="4"/>
                        <text x="1070" y="500" text-anchor="middle" fill="#666" font-size="12">Corsa</text>
                        <text x="1070" y="515" text-anchor="middle" fill="#F44336" font-size="9">(wordt uitgefaseerd)</text>
                    </g>

                </svg>
            </div>

            <!-- System detail panel -->
            <div id="system-detail" class="system-detail">
                <p>Kies een perspectief en domein om de keten te zien</p>
            </div>
        </section>

        <!-- Quick actions -->
        <section>
            <h3>Snel naar</h3>
            <div class="cards">
                <a href="perspectief/behandelaar.html" class="card">
                    <h4>Wat verandert er voor mij?</h4>
                    <p>Als behandelaar werk je straks in de keten. Ontdek wat dit betekent.</p>
                </a>
                <a href="implementatie/7-vinkjes.html" class="card">
                    <h4>De 7 Vinkjes</h4>
                    <p>Hoe wordt een nieuw zaaktype aangesloten? Bekijk het implementatieproces.</p>
                </a>
                <a href="perspectief/aanvrager.html" class="card">
                    <h4>Vanuit de burger gezien</h4>
                    <p>Volg een aanvraag van begin tot eind vanuit het perspectief van de aanvrager.</p>
                </a>
                <a href="componenten/systemen.html" class="card">
                    <h4>Alle systemen</h4>
                    <p>Overzicht van alle componenten in de keten en hun functie.</p>
                </a>
            </div>
        </section>

        <!-- Info box -->
        <section>
            <div class="info-box success">
                <strong>GPK is live!</strong> De Gehandicaptenparkeerkaart is het eerste zaaktype uit het Sociaal Domein dat volledig zaakgericht werkt. WMO Melding en WMO aanvragen volgen binnenkort.
            </div>
        </section>
    </main>

    <footer>
        <p>Zaaksysteem Ketenvisualisatie - Gemeente Westland - Team Informatiebeheer</p>
    </footer>

    <script src="js/flow.js"></script>
    <script>
        // Flow configurations per perspective and domain
        // Node positions (box edges):
        // gemeentewestland: 60-220, 100-150    simform: 280-420, 100-150   ediensten: 280-420, 170-220
        // digid: 280-420, 400-440              rx-enterprise: 500-700, 180-250
        // centric-bz: 480-590, 300-350         s4sd: 600-710, 300-350
        // pip: 780-940, 130-190                rx-front: 1000-1140, 130-190
        // post: 60-220, 310-360                scanner: 280-420, 310-360
        const flowConfigs = {
            'aanvrager-sd': {
                nodes: ['gemeentewestland', 'simform', 'digid', 'rx-enterprise', 's4sd', 'pip'],
                // gemeentewestland → simform → digid → rx-enterprise → s4sd → pip
                path: 'M220,125 L280,125 L350,150 L350,400 L350,440 L450,440 L450,250 L500,215 L700,215 L710,250 L655,300 L655,350 L750,350 L750,160 L780,160'
            },
            'aanvrager-bz': {
                nodes: ['gemeentewestland', 'ediensten', 'digid', 'centric-bz', 'rx-enterprise', 'pip'],
                // gemeentewestland → ediensten → digid → centric-bz → rx-enterprise → pip
                path: 'M140,150 L140,195 L280,195 L350,220 L350,400 L350,440 L450,440 L450,325 L480,325 L535,350 L535,380 L720,380 L720,215 L700,215 L700,180 L780,160'
            },
            'behandelaar': {
                nodes: ['rx-enterprise', 'centric-bz', 's4sd', 'stratech', 'scanner'],
                // werkvoorraad: scanner → rx-enterprise → afhandelsystemen
                path: 'M420,335 L460,335 L460,250 L500,250 L600,250 L600,300 L535,300 L535,350 L535,380 L600,380 L655,350 L655,300'
            },
            'kcc': {
                nodes: ['rx-front', 'rx-enterprise', 'pip', 'telefoon'],
                // KCC belt burger, zoekt in Rx.Front, ziet alles
                path: 'M220,270 L240,270 L240,100 L980,100 L1070,130 L1070,190 L1000,220 L860,220 L860,190 L780,160 L740,160 L740,180 L700,180'
            },
            'registratie': {
                nodes: ['post', 'scanner', 'rx-enterprise'],
                // post → scanner → rx-enterprise werkvoorraad
                path: 'M220,335 L280,335 L420,335 L460,335 L460,250 L500,215 L600,215'
            }
        };

        // Perspective cards
        document.querySelectorAll('.perspective-card').forEach(card => {
            card.addEventListener('click', function() {
                const perspective = this.dataset.perspective;

                // Update active state
                document.querySelectorAll('.perspective-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');

                // Hide all flow paths
                document.querySelectorAll('.flow-path').forEach(p => p.classList.remove('visible'));

                // Reset nodes
                document.querySelectorAll('.node').forEach(n => {
                    n.classList.remove('dimmed', 'highlighted');
                });

                // Show submenu for aanvrager
                const submenu = document.getElementById('submenu-aanvrager');
                if (perspective === 'aanvrager') {
                    submenu.classList.add('visible');
                    document.querySelectorAll('.submenu-option').forEach(o => o.classList.remove('active'));
                } else {
                    submenu.classList.remove('visible');

                    // Apply flow for other perspectives
                    const config = flowConfigs[perspective];
                    if (config) {
                        applyFlow(config);
                    }
                }
            });
        });

        // Submenu options
        document.querySelectorAll('.submenu-option').forEach(option => {
            option.addEventListener('click', function() {
                const flow = this.dataset.flow;

                // Update active state
                document.querySelectorAll('.submenu-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');

                // Get config
                const config = flowConfigs['aanvrager-' + flow];
                if (config) {
                    applyFlow(config);

                    // Show animated path
                    const svg = document.querySelector('.flow-diagram svg');
                    let flowPath = document.getElementById('dynamic-flow');
                    if (!flowPath) {
                        flowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                        flowPath.id = 'dynamic-flow';
                        flowPath.classList.add('flow-path');
                        // Insert after defs but before nodes
                        const firstNode = svg.querySelector('.node');
                        svg.insertBefore(flowPath, firstNode);
                    }
                    flowPath.setAttribute('d', config.path);
                    flowPath.classList.add('visible');
                }
            });
        });

        function applyFlow(config) {
            const allNodes = document.querySelectorAll('.node');

            // Hide any existing dynamic flow first
            const existingFlow = document.getElementById('dynamic-flow');
            if (existingFlow) {
                existingFlow.classList.remove('visible');
            }

            // Dim all nodes first
            allNodes.forEach(node => {
                node.classList.add('dimmed');
                node.classList.remove('highlighted');
            });

            // Highlight relevant nodes
            config.nodes.forEach(nodeId => {
                const node = document.querySelector(`[data-system="${nodeId}"]`);
                if (node) {
                    node.classList.remove('dimmed');
                    node.classList.add('highlighted');
                }
            });

            // Draw path if exists
            if (config.path) {
                const svg = document.querySelector('.flow-diagram svg');
                let flowPath = document.getElementById('dynamic-flow');
                if (!flowPath) {
                    flowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    flowPath.id = 'dynamic-flow';
                    flowPath.classList.add('flow-path');
                    flowPath.setAttribute('marker-end', 'url(#arrowhead-flow)');
                    const firstNode = svg.querySelector('.node');
                    svg.insertBefore(flowPath, firstNode);
                }
                flowPath.setAttribute('d', config.path);
                setTimeout(() => flowPath.classList.add('visible'), 50);
            }
        }
    </script>
</body>
</html>
