<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaaksysteem Keten - Gemeente Westland</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .submenu {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--gray-light);
            border-radius: 8px;
        }
        .submenu.visible {
            display: block;
        }
        .submenu-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text);
        }
        .submenu-options {
            display: flex;
            gap: 0.75rem;
        }
        .submenu-option {
            padding: 0.75rem 1.5rem;
            background: var(--white);
            border: 2px solid var(--gray);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .submenu-option:hover {
            border-color: var(--primary-light);
        }
        .submenu-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .flow-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .flow-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--white);
            border: 2px solid var(--gray);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        .flow-step:hover {
            border-color: var(--primary-light);
            background: #f0fff0;
        }
        .flow-step.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        .flow-step.completed {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }
        .step-num {
            width: 22px;
            height: 22px;
            background: var(--gray);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
        }
        .flow-step.active .step-num,
        .flow-step.completed .step-num {
            background: rgba(255,255,255,0.3);
        }
        .step-description {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--white);
            border-left: 4px solid var(--primary-light);
            border-radius: 0 8px 8px 0;
            font-size: 0.95rem;
        }
        .flow-path {
            fill: none;
            stroke: var(--primary-light);
            stroke-width: 4;
            stroke-dasharray: 12 6;
            stroke-linecap: round;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .flow-path.visible {
            opacity: 1;
            animation: flowDash 1s linear infinite;
        }
        @keyframes flowDash {
            to { stroke-dashoffset: -18; }
        }
        .node.dimmed {
            opacity: 0.25;
        }
        .node.highlighted {
            opacity: 1;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="https://www.gemeentewestland.nl/fileadmin/Gemeente_Westland/site_assets/logowestland.svg" alt="Gemeente Westland">
        </div>
        <h1>Zaaksysteem Ketenvisualisatie</h1>
    </header>

    <nav>
        <ul>
            <li><a href="index.html" class="active">Overzicht</a></li>
            <li><a href="perspectief/behandelaar.html">Behandelaar</a></li>
            <li><a href="perspectief/aanvrager.html">Aanvrager</a></li>
            <li><a href="perspectief/kcc.html">KCC</a></li>
            <li><a href="implementatie/7-vinkjes.html">7 Vinkjes</a></li>
            <li><a href="componenten/systemen.html">Systemen</a></li>
        </ul>
    </nav>

    <main>
        <!-- Perspective switcher -->
        <section>
            <h3>Bekijk de keten vanuit jouw perspectief</h3>
            <div class="perspective-cards">
                <div class="perspective-card" data-perspective="aanvrager">
                    <h5>Aanvrager</h5>
                    <p>Burger of bedrijf</p>
                </div>
                <div class="perspective-card" data-perspective="behandelaar">
                    <h5>Behandelaar</h5>
                    <p>Werkt in de keten</p>
                </div>
                <div class="perspective-card" data-perspective="kcc">
                    <h5>KCC</h5>
                    <p>Klantcontact</p>
                </div>
                <div class="perspective-card" data-perspective="registratie">
                    <h5>Team Registratie</h5>
                    <p>Post en scan</p>
                </div>
            </div>

            <!-- Submenu voor aanvrager -->
            <div id="submenu-aanvrager" class="submenu">
                <div class="submenu-title">Kies een domein:</div>
                <div class="submenu-options">
                    <div class="submenu-option" data-flow="sd">Sociaal Domein (WMO, GPK)</div>
                    <div class="submenu-option" data-flow="bz">Burgerzaken (Paspoort, Rijbewijs)</div>
                </div>
            </div>

            <!-- Stappen voor behandelaar -->
            <div id="submenu-behandelaar" class="submenu">
                <div class="submenu-title">Volg de behandeling stap voor stap:</div>
                <div class="flow-steps">
                    <div class="flow-step" data-step="beh-1">
                        <span class="step-num">1</span>
                        <span class="step-text">Aanvraag in werkvoorraad</span>
                    </div>
                    <div class="flow-step" data-step="beh-2">
                        <span class="step-num">2</span>
                        <span class="step-text">Behandelaar pakt zaak op</span>
                    </div>
                    <div class="flow-step" data-step="beh-3">
                        <span class="step-num">3</span>
                        <span class="step-text">Notificatie: "In behandeling"</span>
                    </div>
                    <div class="flow-step" data-step="beh-4">
                        <span class="step-num">4</span>
                        <span class="step-text">Aanvullende stukken nodig</span>
                    </div>
                    <div class="flow-step" data-step="beh-5">
                        <span class="step-num">5</span>
                        <span class="step-text">Aanvrager uploadt via PIP</span>
                    </div>
                    <div class="flow-step" data-step="beh-6">
                        <span class="step-num">6</span>
                        <span class="step-text">Zaak afgehandeld, beschikking</span>
                    </div>
                </div>
            </div>

            <!-- Stappen voor KCC -->
            <div id="submenu-kcc" class="submenu">
                <div class="submenu-title">KCC klantcontact:</div>
                <div class="flow-steps">
                    <div class="flow-step" data-step="kcc-1">
                        <span class="step-num">1</span>
                        <span class="step-text">Klant belt met vraag</span>
                    </div>
                    <div class="flow-step" data-step="kcc-2">
                        <span class="step-num">2</span>
                        <span class="step-text">KCC zoekt op BSN in Rx.Front</span>
                    </div>
                    <div class="flow-step" data-step="kcc-3">
                        <span class="step-num">3</span>
                        <span class="step-text">Ziet alle zaken + status</span>
                    </div>
                    <div class="flow-step" data-step="kcc-4">
                        <span class="step-num">4</span>
                        <span class="step-text">Terugbelverzoek of doorverbinden</span>
                    </div>
                </div>
            </div>

            <!-- Stappen voor registratie -->
            <div id="submenu-registratie" class="submenu">
                <div class="submenu-title">Post en scan verwerking:</div>
                <div class="flow-steps">
                    <div class="flow-step" data-step="reg-1">
                        <span class="step-num">1</span>
                        <span class="step-text">Post of mail komt binnen</span>
                    </div>
                    <div class="flow-step" data-step="reg-2">
                        <span class="step-num">2</span>
                        <span class="step-text">Scannen met Dyanix Scansuite</span>
                    </div>
                    <div class="flow-step" data-step="reg-3">
                        <span class="step-num">3</span>
                        <span class="step-text">Document in werkvoorraad</span>
                    </div>
                    <div class="flow-step" data-step="reg-4">
                        <span class="step-num">4</span>
                        <span class="step-text">Toewijzen aan behandelaar</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main flow diagram -->
        <section class="flow-container">
            <h3>De Zaaksysteem Keten</h3>
            <div class="toggle-container">
                <span>Toon technische laag</span>
                <div class="toggle" data-target="tech-layer"></div>
            </div>

            <div class="flow-diagram">
                <svg viewBox="0 0 1200 600" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrowhead-flow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#74B943"/>
                        </marker>
                    </defs>

                    <!-- Background layers -->
                    <rect x="40" y="40" width="200" height="520" fill="#E8F5E9" rx="8" opacity="0.5"/>
                    <text x="140" y="70" text-anchor="middle" font-size="14" fill="#44772C" font-weight="600">KANALEN</text>

                    <rect x="260" y="40" width="180" height="520" fill="#E3F2FD" rx="8" opacity="0.5"/>
                    <text x="350" y="70" text-anchor="middle" font-size="14" fill="#1976D2" font-weight="600">INTAKE</text>

                    <rect x="460" y="40" width="280" height="520" fill="#FFF3E0" rx="8" opacity="0.5"/>
                    <text x="600" y="70" text-anchor="middle" font-size="14" fill="#E65100" font-weight="600">VERWERKING</text>

                    <rect x="760" y="40" width="200" height="520" fill="#F3E5F5" rx="8" opacity="0.5"/>
                    <text x="860" y="70" text-anchor="middle" font-size="14" fill="#7B1FA2" font-weight="600">TERUGKOPPELING</text>

                    <rect x="980" y="40" width="180" height="520" fill="#E0F7FA" rx="8" opacity="0.5"/>
                    <text x="1070" y="70" text-anchor="middle" font-size="14" fill="#00838F" font-weight="600">INZICHT</text>

                    <!-- KANALEN -->
                    <g class="node node-kanaal" data-system="gemeentewestland">
                        <rect x="60" y="100" width="160" height="50" fill="#4CAF50" rx="6"/>
                        <text x="140" y="130" text-anchor="middle" fill="white" font-size="13" font-weight="500">gemeentewestland.nl</text>
                    </g>

                    <g class="node node-kanaal" data-system="balie">
                        <rect x="60" y="170" width="160" height="50" fill="#66BB6A" rx="6"/>
                        <text x="140" y="200" text-anchor="middle" fill="white" font-size="13" font-weight="500">Balie</text>
                    </g>

                    <g class="node node-kanaal" data-system="telefoon">
                        <rect x="60" y="240" width="160" height="50" fill="#81C784" rx="6"/>
                        <text x="140" y="270" text-anchor="middle" fill="white" font-size="13" font-weight="500">Telefoon</text>
                    </g>

                    <g class="node node-kanaal" data-system="post">
                        <rect x="60" y="310" width="160" height="50" fill="#A5D6A7" rx="6"/>
                        <text x="140" y="340" text-anchor="middle" fill="#1A1919" font-size="13" font-weight="500">Post / Scan</text>
                    </g>

                    <!-- INTAKE -->
                    <g class="node node-formulier" data-system="simform">
                        <rect x="280" y="100" width="140" height="50" fill="#2196F3" rx="6"/>
                        <text x="350" y="130" text-anchor="middle" fill="white" font-size="13" font-weight="500">SIMform</text>
                    </g>

                    <g class="node node-formulier" data-system="ediensten">
                        <rect x="280" y="170" width="140" height="50" fill="#42A5F5" rx="6"/>
                        <text x="350" y="200" text-anchor="middle" fill="white" font-size="13" font-weight="500">Centric eDiensten</text>
                    </g>

                    <g class="node" data-system="digid">
                        <rect x="280" y="400" width="140" height="40" fill="#FF5722" rx="6"/>
                        <text x="350" y="425" text-anchor="middle" fill="white" font-size="12" font-weight="500">DigiD</text>
                    </g>

                    <g class="node" data-system="eherkenning">
                        <rect x="280" y="450" width="140" height="40" fill="#FF7043" rx="6"/>
                        <text x="350" y="475" text-anchor="middle" fill="white" font-size="12" font-weight="500">eHerkenning</text>
                        <text x="350" y="490" text-anchor="middle" fill="white" font-size="9">(komt erbij)</text>
                    </g>

                    <!-- Scanner detail -->
                    <g class="node" data-system="scanner">
                        <rect x="280" y="310" width="140" height="50" fill="#78909C" rx="6"/>
                        <text x="350" y="335" text-anchor="middle" fill="white" font-size="12" font-weight="500">Dyanix Scansuite</text>
                        <text x="350" y="350" text-anchor="middle" fill="white" font-size="10">Team Registratie</text>
                    </g>

                    <!-- VERWERKING -->
                    <g class="node node-zaaksysteem" data-system="rx-enterprise">
                        <rect x="500" y="180" width="200" height="70" fill="#44772C" rx="8"/>
                        <text x="600" y="210" text-anchor="middle" fill="white" font-size="15" font-weight="600">Rx.Enterprise</text>
                        <text x="600" y="230" text-anchor="middle" fill="white" font-size="11">Zaaksysteem + Documenten</text>
                    </g>

                    <!-- Afhandelsystemen -->
                    <g class="node node-afhandel" data-system="centric-bz">
                        <rect x="480" y="300" width="110" height="50" fill="#FF9800" rx="6"/>
                        <text x="535" y="325" text-anchor="middle" fill="white" font-size="11" font-weight="500">Centric</text>
                        <text x="535" y="340" text-anchor="middle" fill="white" font-size="11" font-weight="500">Burgerzaken</text>
                    </g>

                    <g class="node node-afhandel" data-system="s4sd">
                        <rect x="600" y="300" width="110" height="50" fill="#FFA726" rx="6"/>
                        <text x="655" y="325" text-anchor="middle" fill="white" font-size="11" font-weight="500">Suite4SD</text>
                        <text x="655" y="340" text-anchor="middle" fill="white" font-size="10">(GPK live!)</text>
                    </g>

                    <g class="node node-afhandel" data-system="stratech">
                        <rect x="480" y="360" width="110" height="45" fill="#FFB74D" rx="6"/>
                        <text x="535" y="385" text-anchor="middle" fill="#1A1919" font-size="11" font-weight="500">Stratech</text>
                        <text x="535" y="398" text-anchor="middle" fill="#1A1919" font-size="9">(naar cloud)</text>
                    </g>

                    <g class="node node-afhandel" data-system="toekomstig" style="opacity: 0.6">
                        <rect x="600" y="360" width="110" height="45" fill="#FFE0B2" rx="6" stroke="#FF9800" stroke-dasharray="4"/>
                        <text x="655" y="385" text-anchor="middle" fill="#1A1919" font-size="11">JVS, Begraven</text>
                        <text x="655" y="398" text-anchor="middle" fill="#666" font-size="9">(toekomstig)</text>
                    </g>

                    <!-- Middleware (tech layer) -->
                    <g id="tech-layer" class="node node-middleware" data-system="enable-u">
                        <rect x="500" y="430" width="200" height="45" fill="#607D8B" rx="6"/>
                        <text x="600" y="455" text-anchor="middle" fill="white" font-size="12" font-weight="500">Enable-U (API Gateway)</text>
                        <text x="600" y="468" text-anchor="middle" fill="white" font-size="9">Filter zaak- en documenttypen</text>
                    </g>

                    <g id="tech-layer-2" class="node node-middleware" data-system="cloudadapter" style="opacity: 0.7">
                        <rect x="500" y="490" width="200" height="35" fill="#78909C" rx="6"/>
                        <text x="600" y="512" text-anchor="middle" fill="white" font-size="11">Centric Cloud Adapter</text>
                    </g>

                    <!-- TERUGKOPPELING -->
                    <g class="node node-pip" data-system="pip">
                        <rect x="780" y="130" width="160" height="60" fill="#9C27B0" rx="6"/>
                        <text x="860" y="158" text-anchor="middle" fill="white" font-size="14" font-weight="500">PIP</text>
                        <text x="860" y="175" text-anchor="middle" fill="white" font-size="10">Status volgen</text>
                        <text x="860" y="187" text-anchor="middle" fill="white" font-size="10">Documenten up/download</text>
                    </g>

                    <g class="node" data-system="notificatie">
                        <rect x="780" y="210" width="160" height="45" fill="#BA68C8" rx="6"/>
                        <text x="860" y="237" text-anchor="middle" fill="white" font-size="12" font-weight="500">Notificaties (mail)</text>
                    </g>

                    <!-- INZICHT -->
                    <g class="node node-kcc" data-system="rx-front">
                        <rect x="1000" y="130" width="140" height="60" fill="#00BCD4" rx="6"/>
                        <text x="1070" y="158" text-anchor="middle" fill="white" font-size="14" font-weight="500">Rx.Front</text>
                        <text x="1070" y="175" text-anchor="middle" fill="white" font-size="10">KCC - Klantbeeld</text>
                    </g>

                    <g class="node" data-system="powerbi">
                        <rect x="1000" y="210" width="140" height="45" fill="#26C6DA" rx="6"/>
                        <text x="1070" y="237" text-anchor="middle" fill="white" font-size="12" font-weight="500">PowerBI / DWH</text>
                    </g>

                    <!-- Legacy -->
                    <g class="node" data-system="corsa" style="opacity: 0.5">
                        <rect x="1000" y="480" width="140" height="45" fill="#BDBDBD" rx="6" stroke="#F44336" stroke-dasharray="4"/>
                        <text x="1070" y="500" text-anchor="middle" fill="#666" font-size="12">Corsa</text>
                        <text x="1070" y="515" text-anchor="middle" fill="#F44336" font-size="9">(wordt uitgefaseerd)</text>
                    </g>

                </svg>
            </div>

            <!-- System detail panel -->
            <div id="system-detail" class="system-detail">
                <p>Kies een perspectief en klik op een stap om de keten te volgen</p>
            </div>
        </section>

        <!-- Quick actions -->
        <section>
            <h3>Snel naar</h3>
            <div class="cards">
                <a href="perspectief/behandelaar.html" class="card">
                    <h4>Wat verandert er voor mij?</h4>
                    <p>Als behandelaar werk je straks in de keten. Ontdek wat dit betekent.</p>
                </a>
                <a href="implementatie/7-vinkjes.html" class="card">
                    <h4>De 7 Vinkjes</h4>
                    <p>Hoe wordt een nieuw zaaktype aangesloten? Bekijk het implementatieproces.</p>
                </a>
                <a href="perspectief/aanvrager.html" class="card">
                    <h4>Vanuit de burger gezien</h4>
                    <p>Volg een aanvraag van begin tot eind vanuit het perspectief van de aanvrager.</p>
                </a>
                <a href="componenten/systemen.html" class="card">
                    <h4>Alle systemen</h4>
                    <p>Overzicht van alle componenten in de keten en hun functie.</p>
                </a>
            </div>
        </section>

        <!-- Info box -->
        <section>
            <div class="info-box success">
                <strong>GPK is live!</strong> De Gehandicaptenparkeerkaart is het eerste zaaktype uit het Sociaal Domein dat volledig zaakgericht werkt. WMO Melding en WMO aanvragen volgen binnenkort.
            </div>
        </section>
    </main>

    <footer>
        <p>Zaaksysteem Ketenvisualisatie - Gemeente Westland - Team Informatiebeheer</p>
    </footer>

    <script src="js/flow.js"></script>
    <script>
        // Step-by-step flow configurations
        const stepConfigs = {
            // Behandelaar stappen
            'beh-1': {
                nodes: ['rx-enterprise'],
                path: null,
                description: 'De aanvraag staat in de werkvoorraad van Rx.Enterprise. De behandelaar ziet dit in zijn takenlijst.'
            },
            'beh-2': {
                nodes: ['rx-enterprise', 's4sd', 'centric-bz'],
                path: 'M600,250 L600,300 L655,300',
                description: 'Behandelaar opent de zaak en werkt in het afhandelsysteem (S4SD, Centric BZ, etc.). Status wordt "In behandeling".'
            },
            'beh-3': {
                nodes: ['rx-enterprise', 'notificatie', 'pip'],
                path: 'M700,215 L750,215 L750,232 L780,232',
                description: 'Automatisch gaat er een notificatie naar de aanvrager: "Uw aanvraag is in behandeling".'
            },
            'beh-4': {
                nodes: ['rx-enterprise', 'notificatie', 'pip'],
                path: 'M700,215 L750,215 L750,232 L780,232 L940,232 L940,160 L860,160',
                description: 'Behandelaar heeft aanvullende stukken nodig. Verzoek gaat via notificatie naar de PIP van de aanvrager.'
            },
            'beh-5': {
                nodes: ['pip', 'rx-enterprise'],
                path: 'M860,190 L860,250 L700,250 L700,215',
                description: 'Aanvrager uploadt documenten via de PIP. Deze komen direct in het dossier in Rx.Enterprise.'
            },
            'beh-6': {
                nodes: ['rx-enterprise', 's4sd', 'notificatie', 'pip'],
                path: 'M655,300 L655,280 L700,250 L700,215 L750,215 L750,232 L780,232 L940,232 L940,160 L860,160',
                description: 'Zaak wordt afgehandeld, beschikking wordt verstuurd. Aanvrager ontvangt notificatie en kan beschikking downloaden via PIP.'
            },
            // KCC stappen
            'kcc-1': {
                nodes: ['telefoon'],
                path: null,
                description: 'Een burger belt het KCC met een vraag over een lopende aanvraag.'
            },
            'kcc-2': {
                nodes: ['telefoon', 'rx-front'],
                path: 'M220,270 L980,270 L1000,200 L1000,160',
                description: 'KCC-medewerker opent Rx.Front en zoekt de burger op via BSN. Het integrale klantbeeld verschijnt.'
            },
            'kcc-3': {
                nodes: ['rx-front', 'rx-enterprise', 'pip'],
                path: 'M1000,160 L950,160 L950,100 L600,100 L600,180',
                description: 'KCC ziet alle lopende en afgeronde zaken, de actuele status, en wie de behandelaar is. Dezelfde info als op de PIP.'
            },
            'kcc-4': {
                nodes: ['rx-front', 'rx-enterprise'],
                path: 'M1070,190 L1070,250 L700,250 L700,215',
                description: 'KCC kan een terugbelverzoek inplannen of direct doorverbinden met de behandelaar. Alles wordt gelogd.'
            },
            // Team Registratie stappen
            'reg-1': {
                nodes: ['post'],
                path: null,
                description: 'Post of e-mail komt binnen bij Team Registratie.'
            },
            'reg-2': {
                nodes: ['post', 'scanner'],
                path: 'M220,335 L280,335',
                description: 'Document wordt gescand met de Dyanix Scansuite. Metadata wordt toegevoegd.'
            },
            'reg-3': {
                nodes: ['scanner', 'rx-enterprise'],
                path: 'M420,335 L460,335 L460,250 L500,215',
                description: 'Gescand document komt in de werkvoorraad van Rx.Enterprise.'
            },
            'reg-4': {
                nodes: ['rx-enterprise'],
                path: null,
                description: 'Team Registratie wijst het document toe aan de juiste behandelaar of koppelt het aan een bestaande zaak.'
            }
        };

        // Aanvrager flow configurations (domain choice)
        const flowConfigs = {
            'aanvrager-sd': {
                nodes: ['gemeentewestland', 'simform', 'digid', 'rx-enterprise', 's4sd', 'pip'],
                path: 'M220,125 L280,125 L350,150 L350,400 L350,440 L450,440 L450,250 L500,215 L700,215 L710,250 L655,300 L655,350 L750,350 L750,160 L780,160',
                description: 'Burger vult formulier in op gemeentewestland.nl (SIMform), authenticeert met DigiD, zaak gaat naar Rx.Enterprise, wordt behandeld in S4SD, burger volgt status via PIP.'
            },
            'aanvrager-bz': {
                nodes: ['gemeentewestland', 'ediensten', 'digid', 'centric-bz', 'rx-enterprise', 'pip'],
                path: 'M140,150 L140,195 L280,195 L350,220 L350,400 L350,440 L450,440 L450,325 L480,325 L535,350 L535,380 L720,380 L720,215 L700,215 L700,180 L780,160',
                description: 'Burger vraagt paspoort/rijbewijs aan via eDiensten, authenticeert met DigiD, Centric Burgerzaken verwerkt, synchroniseert met Rx.Enterprise, burger ziet status in PIP.'
            }
        };

        // Hide all submenus
        function hideAllSubmenus() {
            document.querySelectorAll('.submenu').forEach(s => s.classList.remove('visible'));
            document.querySelectorAll('.submenu-option, .flow-step').forEach(o => o.classList.remove('active', 'completed'));
        }

        // Reset diagram
        function resetDiagram() {
            document.querySelectorAll('.flow-path').forEach(p => p.classList.remove('visible'));
            document.querySelectorAll('.node').forEach(n => {
                n.classList.remove('dimmed', 'highlighted');
            });
            updateDescription('');
        }

        // Update description panel
        function updateDescription(text) {
            const panel = document.getElementById('system-detail');
            if (panel) {
                if (text) {
                    panel.innerHTML = '<div class="step-description">' + text + '</div>';
                    panel.classList.add('visible');
                } else {
                    panel.innerHTML = '<p>Kies een perspectief en klik op een stap om de keten te zien</p>';
                    panel.classList.remove('visible');
                }
            }
        }

        // Perspective cards
        document.querySelectorAll('.perspective-card').forEach(card => {
            card.addEventListener('click', function() {
                const perspective = this.dataset.perspective;

                // Update active state
                document.querySelectorAll('.perspective-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');

                // Reset diagram and hide all submenus
                resetDiagram();
                hideAllSubmenus();

                // Show appropriate submenu
                const submenu = document.getElementById('submenu-' + perspective);
                if (submenu) {
                    submenu.classList.add('visible');
                }
            });
        });

        // Submenu options (for aanvrager domain choice)
        document.querySelectorAll('.submenu-option').forEach(option => {
            option.addEventListener('click', function() {
                const flow = this.dataset.flow;

                // Update active state
                document.querySelectorAll('.submenu-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');

                // Get config and apply
                const config = flowConfigs['aanvrager-' + flow];
                if (config) {
                    applyFlow(config);
                    updateDescription(config.description);
                }
            });
        });

        // Flow step clicks
        document.querySelectorAll('.flow-step').forEach(step => {
            step.addEventListener('click', function() {
                const stepId = this.dataset.step;
                const config = stepConfigs[stepId];

                if (!config) return;

                // Mark previous steps as completed, current as active
                const allSteps = this.parentElement.querySelectorAll('.flow-step');
                let foundCurrent = false;
                allSteps.forEach(s => {
                    s.classList.remove('active', 'completed');
                    if (s === this) {
                        s.classList.add('active');
                        foundCurrent = true;
                    } else if (!foundCurrent) {
                        s.classList.add('completed');
                    }
                });

                // Apply the flow
                applyFlow(config);
                updateDescription(config.description);
            });
        });

        function applyFlow(config) {
            const allNodes = document.querySelectorAll('.node');

            // Hide any existing dynamic flow first
            const existingFlow = document.getElementById('dynamic-flow');
            if (existingFlow) {
                existingFlow.classList.remove('visible');
            }

            // Dim all nodes first
            allNodes.forEach(node => {
                node.classList.add('dimmed');
                node.classList.remove('highlighted');
            });

            // Highlight relevant nodes
            config.nodes.forEach(nodeId => {
                const node = document.querySelector(`[data-system="${nodeId}"]`);
                if (node) {
                    node.classList.remove('dimmed');
                    node.classList.add('highlighted');
                }
            });

            // Draw path if exists
            if (config.path) {
                const svg = document.querySelector('.flow-diagram svg');
                let flowPath = document.getElementById('dynamic-flow');
                if (!flowPath) {
                    flowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    flowPath.id = 'dynamic-flow';
                    flowPath.classList.add('flow-path');
                    flowPath.setAttribute('marker-end', 'url(#arrowhead-flow)');
                    const firstNode = svg.querySelector('.node');
                    svg.insertBefore(flowPath, firstNode);
                }
                flowPath.setAttribute('d', config.path);
                setTimeout(() => flowPath.classList.add('visible'), 50);
            }
        }
    </script>
</body>
</html>
